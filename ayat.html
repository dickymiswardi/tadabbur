<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ayat Tadabbur</title>
    <style>
        body {{
            font-family: Arial, sans-serif;
            margin: 40px;
            line-height: 1.6;
            text-align: center;
        }}
        .arabic {{
            font-size: 2em;
            margin: 20px 0;
            direction: rtl;
        }}
        .translation, .note {{
            text-align: left;
            max-width: 700px;
            margin: 0 auto;
        }}
        hr {{
            margin: 40px 0 10px;
        }}
        .source {{
            font-size: 0.9em;
            color: gray;
        }}
    </style>
</head>
<body>
    <h2 id="title">Memuat...</h2>
    <div class="arabic" id="arabic">...</div>
    <div class="translation" id="translation">...</div>
    <p class="note" id="note"><em>Catatan akan dimuat di sini.</em></p>
    <hr />
    <div class="source">Sumber: Quran.com API + King Fahad Quran Complex</div>

    <script>
        function getQueryParam(param) {{
            return new URLSearchParams(window.location.search).get(param);
        }}

        function insertSpaceBeforeSymbols(text) {{
            const symbols = ['ۛ','ۖ','ۚ','ۗ','ۙ','ۘ','ۜ','۝'];
            symbols.forEach(symbol => {{
                const regex = new RegExp(`([^\s])(${symbol})`, 'g');
                text = text.replace(regex, '$1 $2');
            }});
            return text;
        }}

        async function loadAyat() {{
            const surah = getQueryParam("surah") || "1";
            const ayat = getQueryParam("ayat") || "1";
            document.getElementById("title").innerText = `Surah ${surah} Ayat ${ayat}`;

            // Fetch Arabic verse
            const resArab = await fetch(`https://api.quran.com/api/v4/quran/verses/uthmani?verse_key=${surah}:${ayat}`);
            const dataArab = await resArab.json();
            let arabicText = dataArab.verses[0].text_uthmani;
            arabicText = insertSpaceBeforeSymbols(arabicText);
            document.getElementById("arabic").innerText = arabicText;

            // Fetch Indonesian translation
            const resTrans = await fetch(`https://api.quran.com/api/v4/quran/translations/33?verse_key=${surah}:${ayat}`);
            const dataTrans = await resTrans.json();
            document.getElementById("translation").innerText = dataTrans.translations[0].text;

            // Static note example
            if (surah === "1" && ayat === "6") {{
                document.getElementById("note").innerHTML = `<em>Catatan: 8. Ihdinā (tunjukilah kami), diambil dari kata <i>hidāyat</i> (hidayah), supaya memberi petunjuk ke suatu jalan yang benar. Yang dimaksud dengan ayat ini bukan sekadar memberi hidayah saja, tetapi juga memberi taufik.</em>`;
            }} else {{
                document.getElementById("note").innerHTML = ``;
            }}
        }}

        loadAyat();
    </script>
</body>
</html>
